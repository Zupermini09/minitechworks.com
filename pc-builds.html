<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PC Builds ‚Äì MiniTechWorks</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="dark.css">
  <link rel="icon" href="/favicon.ico" />
  <meta name="description" content="PC Builds ‚Äì Recommended builds managed through MiniTechWorks CMS.">
</head>

<body>

<header class="site-header">
  <div class="container header-inner">
    <a href="index.html" class="logo">
      <img src="favicon.png" class="logo-img" alt="Logo">
      <span class="logo-text">MiniTechWorks</span>
    </a>
    <nav class="nav">
      <a href="3d-print.html">3D Printing</a>
      <a href="pc-builds.html" class="active">PC Builds</a>
      <a href="wiki.html">Tutorials</a>
      <a href="contact.html">Contact</a>
    </nav>
  </div>
</header>

<main>
  <section class="section">
    <div class="container">
      <h1 class="section-title">PC Builds</h1>
      <p>These builds are updated from my CMS and show recommended gaming PCs for different budgets.</p>

      <hr class="divider">

      <!-- Container for PC build cards -->
      <div id="pcList" class="wiki-grid"></div>

    </div>
  </section>
</main>

<footer class="site-footer">
  <div class="container footer-inner">
    <p>¬© <span id="year"></span> MiniTechWorks. Built by Mini.</p>
  </div>
</footer>

<script>
document.getElementById("year").textContent = new Date().getFullYear();

/* Your Discord webhook (encoded) */
const WEBHOOK_B64 =
  "aHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvd2ViaG9va3MvMTQzOTI2NTc4MDcwODU0MDQxNi9GNjNGTG5FNTQzcXFiVHk2Q01UbEQybUh5SjF2djFadzFOQXBpTjJlbXFNUTQwLVJYOEJhVndxWTQ2dVBacEFFcDRBbg==";

const WEBHOOK_URL = atob(WEBHOOK_B64);

async function loadBuilds() {
  const container = document.getElementById("pcList");

  try {
    const res = await fetch("https://api.minitechworks.com/api/pc-builds?sort=order:asc");
    const json = await res.json();
    const builds = json.data;

    if (!builds || builds.length === 0) {
      container.innerHTML = "<p>No builds available.</p>";
      return;
    }

    builds.forEach(build => {
      const b = build.attributes;

      const card = document.createElement("div");
      card.className = "wiki-card card";

      card.innerHTML = `
        <h3>${b.title}</h3>
        <p>${b.description.slice(0, 200)}...</p>

        <button class="btn btn-primary" style="margin-top: 14px;"
          onclick="orderPC('${b.title.replace(/'/g, "\\'")}')">Order this PC</button>
      `;

      container.appendChild(card);
    });

  } catch {
    container.innerHTML = "<p>Failed to load builds.</p>";
  }
}

async function orderPC(title) {
  const message =
    "üñ•Ô∏è **New PC Build Order**\n\n" +
    "**PC Selected:** " + title + "\n" +
    "User clicked the Order button on MiniTechWorks.com.";

  try {
    await fetch(WEBHOOK_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ content: message })
    });

    alert("Order sent! I'll contact you soon.");
  } catch {
    alert("Failed to send. Discord might be blocked on your network.");
  }
}

loadBuilds();
</script>

</body>
</html>
