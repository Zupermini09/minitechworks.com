<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PC Builds ‚Äì MiniTechWorks</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="dark.css">
  <link rel="icon" href="/favicon.ico" />
</head>

<body>

<header class="site-header">
  <div class="container header-inner">
    <a href="index.html" class="logo">
      <img src="favicon.png" class="logo-img" alt="Logo">
      <span class="logo-text">MiniTechWorks</span>
    </a>
    <nav class="nav">
      <a href="3d-print.html">3D Printing</a>
      <a href="pc-builds.html" class="active">PC Builds</a>
      <a href="wiki.html">Tutorials</a>
      <a href="contact.html">Contact</a>
    </nav>
  </div>
</header>

<main>
  <section class="section">
    <div class="container">
      <h1 class="section-title">PC Builds</h1>
      <p>These builds are updated from my CMS and show recommended gaming PCs for different budgets.</p>

      <hr class="divider">

      <div id="pcList" class="wiki-grid"></div>

      <div style="text-align:center; margin-top: 28px;">
        <a href="pc-custom.html" class="btn btn-primary" style="padding: 12px 26px; font-size: 1rem;">
          Get a Custom PC
        </a>
      </div>

    </div>
  </section>
</main>

<footer class="site-footer">
  <div class="container footer-inner">
    <p>¬© <span id="year"></span> MiniTechWorks. Built by Mini.</p>
  </div>
</footer>

<script>
document.getElementById("year").textContent = new Date().getFullYear();

/* ENTER YOUR REAL STRAPI URL HERE */
const API_URL = "https://api.minitechworks.com";  // <-- CHANGE THIS IF WRONG

const WEBHOOK_B64 =
  "aHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvd2ViaG9va3MvMTQzOTI2NTc4MDcwODU0MDQxNi9GNjNGTG5FNTQzcXFiVHk2Q01UbEQybUh5SjF2djFadzFOQXBpTjJlbXFNUTQwLVJYOEJhVndxWTQ2dVBacEFFcDRBbg==";

const WEBHOOK_URL = atob(WEBHOOK_B64);

async function loadBuilds() {
  const container = document.getElementById("pcList");
  container.innerHTML = "<p>Loading PC builds...</p>";

  try {
    const res = await fetch(`${API_URL}/api/pc-builds?populate=image&sort=order:asc`);
    
    if (!res.ok) {
      container.innerHTML = "<p>CMS error. Check publish status & permissions.</p>";
      console.error("Strapi error:", await res.text());
      return;
    }

    const json = await res.json();
    const builds = json.data;

    if (!builds || builds.length === 0) {
      container.innerHTML = "<p>No builds published in CMS.</p>";
      return;
    }

    container.innerHTML = "";

    builds.forEach(build => {
      const b = build.attributes;

      const imageUrl = b.image?.data?.attributes?.url
        ? API_URL + b.image.data.attributes.url
        : "favicon.png";

      const card = document.createElement("div");
      card.className = "wiki-card card";

      card.innerHTML = `
        <img src="${imageUrl}" style="width:100%; border-radius:10px; margin-bottom:12px;">
        <h3>${b.title}</h3>
        <p>${b.description.slice(0, 200)}...</p>

        <button class="btn btn-primary" style="margin-top: 14px;"
          onclick="orderPC('${b.title.replace(/'/g, "\\'")}')">
          Order this PC
        </button>
      `;

      container.appendChild(card);
    });

  } catch (err) {
    container.innerHTML = "<p>Failed to load builds (network/CORS).</p>";
    console.error("Network error:", err);
  }
}

async function orderPC(title) {
  const message =
    "üñ•Ô∏è **New PC Build Order**\n\n" +
    "**Selected PC:** " + title;

  try {
    await fetch(WEBHOOK_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ content: message })
    });

    alert("Order sent! I will contact you soon.");
  } catch {
    alert("Failed to send order. Discord might be blocked.");
  }
}

loadBuilds();
</script>

</body>
</html>
