<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorials & Wiki – MiniTechWorks</title>

  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="dark.css">
  <link rel="icon" href="/favicon.png" />

  <style>
    /* Search bar */
    #search-bar {
      width: 100%;
      padding: 10px 14px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--bg-secondary);
      color: var(--text);
      font-size: 1rem;
    }

    /* Category buttons */
    .category-list {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin: 12px 0 20px;
    }

    .category-btn {
      padding: 6px 14px;
      font-size: 0.85rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: var(--bg-secondary);
      color: var(--text);
      cursor: pointer;
      transition: 0.15s ease;
    }

    .category-btn:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    .category-btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary-dark);
    }

    /* Article image */
    .wiki-card img {
      width: 100%;
      border-radius: var(--radius-md);
      margin-bottom: 10px;
    }

    /* Make entire card clickable, but DO NOT change height */
    .wiki-link {
      display: block;
      text-decoration: none;
      color: inherit;
      height: auto;      /* <- important */
    }

    /* Hover effect on card only */
    .wiki-card:hover {
      border-color: var(--primary);
      transition: 0.15s;
    }
  </style>
</head>

<body>

<header class="site-header">
  <div class="container header-inner">
    <a href="index.html" class="logo">
      <img src="favicon.png" class="logo-img" alt="Logo">
      <span class="logo-text">MiniTechWorks</span>
    </a>
    <nav class="nav">
      <a href="3d-print.html">3D Printing</a>
      <a href="pc-builds.html">PC Builds</a>
      <a href="wiki.html" class="active">Tutorials</a>
      <a href="contact.html">Contact</a>
    </nav>
  </div>
</header>

<main>
  <section class="page-hero">
    <div class="container">
      <h1>Tutorials & Wiki</h1>
      <p class="page-subtitle">
        Articles, guides and helpful tips — automatically loaded from your CMS.
      </p>
    </div>
  </section>

  <section class="section">
    <div class="container">

      <!-- SEARCH BAR -->
      <input id="search-bar" type="text" placeholder="Search articles…">

      <!-- CATEGORY FILTERS -->
      <div class="category-list" id="category-list"></div>

      <p id="wiki-status" class="small-text">Loading articles…</p>

      <div class="wiki-grid" id="wiki-container"></div>
    </div>
  </section>
</main>

<footer class="site-footer">
  <div class="container footer-inner">
    <p>© <span id="year"></span> MiniTechWorks.</p>
  </div>
</footer>

<script>
// Footer year
document.getElementById("year").textContent = new Date().getFullYear();

let articles = [];
let filteredArticles = [];
let activeCategory = "all";

// Load articles
fetch("https://cms.minitechworks.com/articles")
  .then(res => res.json())
  .then(json => {
    if (!Array.isArray(json)) {
      document.getElementById("wiki-status").textContent = "CMS error: returned invalid data.";
      return;
    }

    articles = json;
    filteredArticles = json;
    document.getElementById("wiki-status").textContent = "";

    renderCategories();
    renderArticles();
  })
  .catch(() => {
    document.getElementById("wiki-status").textContent = "Failed to load articles. CMS might be offline.";
  });

// Render article cards
function renderArticles() {
  const grid = document.getElementById("wiki-container");
  grid.innerHTML = "";

  if (filteredArticles.length === 0) {
    grid.innerHTML = "<p>No articles found.</p>";
    return;
  }

  filteredArticles.forEach(item => {
    const imgHtml = item.image ? 
      `<img src="https://cms.minitechworks.com${item.image.url}" alt="Article Image">`
      : "";

    grid.innerHTML += `
      <a class="wiki-link" href="wiki-article.html?slug=${item.slug}">
        <article class="card wiki-card">
          ${imgHtml}
          <h2>${item.title}</h2>
          <p>${item.excerpt || ""}</p>
        </article>
      </a>
    `;
  });
}

// Search behavior
document.getElementById("search-bar").addEventListener("input", e => {
  const text = e.target.value.toLowerCase();
  filteredArticles = articles.filter(a =>
    a.title.toLowerCase().includes(text) ||
    (a.excerpt && a.excerpt.toLowerCase().includes(text)) ||
    (a.content && a.content.toLowerCase().includes(text))
  );

  if (activeCategory !== "all") {
    filteredArticles = filteredArticles.filter(a =>
      a.category && a.category.toLowerCase() === activeCategory
    );
  }

  renderArticles();
});

// Categories
function renderCategories() {
  const list = document.getElementById("category-list");
  list.innerHTML = "";

  const cats = [...new Set(articles.map(a => a.category).filter(Boolean))];

  list.innerHTML += `<button class="category-btn active" data-cat="all">All</button>`;

  cats.forEach(cat => {
    list.innerHTML += `<button class="category-btn" data-cat="${cat.toLowerCase()}">${cat}</button>`;
  });

  document.querySelectorAll(".category-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".category-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      activeCategory = btn.dataset.cat;
      filterByCategory();
    });
  });
}

function filterByCategory() {
  let result = articles;

  if (activeCategory !== "all") {
    result = result.filter(a =>
      a.category && a.category.toLowerCase() === activeCategory
    );
  }

  const text = document.getElementById("search-bar").value.toLowerCase();

  filteredArticles = result.filter(a =>
    a.title.toLowerCase().includes(text) ||
    (a.excerpt && a.excerpt.toLowerCase().includes(text)) ||
    (a.content && a.content.toLowerCase().includes(text))
  );

  renderArticles();
}
</script>

</body>
</html>
